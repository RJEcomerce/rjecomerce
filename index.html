<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Super Vendas - Loja Online</title>
    <script src="https://cdn.tailwindcss.com "></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css "/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js "></script>
    <style>
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.2);
        }
        .login-container {
            background: linear-gradient(135deg, #1E1E1E 0%, #121212 100%);
            border: 1px solid #D4AF37;
        }
        .admin-nav {
            background: linear-gradient(90deg, #121212 0%, #1E1E1E 100%);
            border-right: 1px solid #D4AF37;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .password-strength {
            height: 4px;
            margin-top: 4px;
            transition: all 0.3s ease;
        }
        .strength-0 { width: 20%; background-color: #ef4444; }
        .strength-1 { width: 40%; background-color: #f59e0b; }
        .strength-2 { width: 60%; background-color: #f59e0b; }
        .strength-3 { width: 80%; background-color: #10b981; }
        .strength-4 { width: 100%; background-color: #10b981; }
        .gold-border {
            border-color: #D4AF37;
        }
        .gold-text {
            color: #D4AF37;
        }
        .gold-bg {
            background-color: #D4AF37;
        }
        .gold-bg:hover {
            background-color: #C9A227;
        }
        .dark-bg {
            background-color: #121212;
        }
        .table-header {
            background-color: #1E1E1E;
            color: #D4AF37;
        }
        .table-row:hover {
            background-color: #2A2A2A;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Navigation -->
    <nav class="bg-black text-gold-500 shadow-lg border-b border-gold-500">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold flex items-center">
                <i class="fas fa-crown mr-2"></i>
                Super Vendas
            </a>
            <div class="flex space-x-4">
                <a href="#" id="shop-link" class="hover:text-gold-600">Loja</a>
                <a href="#" id="admin-link" class="hidden hover:text-gold-600">Admin</a>
                <a href="#" id="login-link" class="hover:text-gold-600">Login</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Shop Page -->
        <div id="shop-page">
            <h1 class="text-3xl font-bold mb-8 text-center gold-text">Nossos Produtos</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Product cards will be loaded here dynamically -->
            </div>
        </div>

        <!-- Login Page -->
        <div id="login-page" class="hidden max-w-md mx-auto mt-16 p-8 rounded-xl shadow-xl login-container">
            <h2 class="text-2xl font-bold mb-6 text-center gold-text">Área do Administrador</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label for="username" class="block gold-text mb-2">Usuário</label>
                    <input type="text" id="username" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-800 border-gold-500 text-white" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block gold-text mb-2">Senha</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-800 border-gold-500 text-white" required>
                </div>
                <button type="submit" class="w-full gold-bg hover:bg-gold-600 text-dark-900 py-2 px-4 rounded-lg font-medium transition duration-300">
                    Entrar
                </button>
            </form>
            <div id="login-error" class="mt-4 text-red-500 text-center hidden">
                Usuário ou senha incorretos!
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="hidden">
            <div class="flex">
                <!-- Sidebar -->
                <div class="w-64 min-h-screen admin-nav text-gold-500 p-4">
                    <h2 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-user-shield mr-2"></i> Painel Admin
                    </h2>
                    <ul class="space-y-2">
                        <li><a href="#" id="admin-products" class="block py-2 px-4 rounded hover:bg-gray-800 bg-gray-800 border border-gold-500"><i class="fas fa-box-open mr-2"></i>Produtos</a></li>
                        <li><a href="#" id="admin-add-product" class="block py-2 px-4 rounded hover:bg-gray-800 border border-gold-500"><i class="fas fa-plus-circle mr-2"></i>Adicionar Produto</a></li>
                        <li><a href="#" id="admin-change-password" class="block py-2 px-4 rounded hover:bg-gray-800 border border-gold-500"><i class="fas fa-key mr-2"></i>Alterar Senha</a></li>
                        <li><a href="#" id="admin-logout" class="block py-2 px-4 rounded hover:bg-gray-800 border border-gold-500"><i class="fas fa-sign-out-alt mr-2"></i>Sair</a></li>
                    </ul>
                </div>

                <!-- Admin Content -->
                <div class="flex-1 p-8 bg-gray-900">
                    <!-- Products List -->
                    <div id="admin-products-content">
                        <h2 class="text-2xl font-bold gold-text mb-6">Gerenciar Produtos</h2>
                        <div class="rounded-lg shadow overflow-hidden border border-gold-500">
                            <table class="min-w-full divide-y divide-gold-500">
                                <thead class="table-header">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Imagem</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Nome</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Preço</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Link</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-products-list" class="bg-gray-800 divide-y divide-gold-500"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Add/Edit Product Form -->
                    <div id="admin-add-product-content" class="hidden">
                        <h2 class="text-2xl font-bold gold-text mb-6">Adicionar / Editar Produto</h2>
                        <form id="add-product-form" class="bg-gray-800 p-6 rounded-lg shadow border border-gold-500">
                            <input type="hidden" id="product-id">
                            <div class="mb-4">
                                <label for="product-name" class="block gold-text mb-2">Nome do Produto</label>
                                <input type="text" id="product-name" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-700 border-gold-500 text-white" required>
                            </div>
                            <div class="mb-4">
                                <label for="product-price" class="block gold-text mb-2">Preço</label>
                                <input type="number" step="0.01" id="product-price" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-700 border-gold-500 text-white" required>
                            </div>
                            <div class="mb-4">
                                <label for="product-description" class="block gold-text mb-2">Descrição</label>
                                <textarea id="product-description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-700 border-gold-500 text-white" required></textarea>
                            </div>
                            <div class="mb-4">
                                <label for="product-image" class="block gold-text mb-2">URL da Imagem</label>
                                <input type="url" id="product-image" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-700 border-gold-500 text-white" required>
                            </div>
                            <div class="mb-6">
                                <label for="product-link" class="block gold-text mb-2">Link de Compra</label>
                                <input type="url" id="product-link" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-700 border-gold-500 text-white" required>
                            </div>
                            <div class="flex justify-end space-x-4">
                                <button type="button" id="cancel-add-product" class="px-4 py-2 border border-gold-500 rounded-lg text-gold-500 hover:bg-gray-700">Cancelar</button>
                                <button type="submit" class="px-4 py-2 gold-bg hover:bg-gold-600 text-dark-900 rounded-lg">Salvar Produto</button>
                            </div>
                        </form>
                    </div>

                    <!-- Change Password Form -->
                    <div id="admin-change-password-content" class="hidden">
                        <h2 class="text-2xl font-bold gold-text mb-6">Alterar Senha</h2>
                        <form id="change-password-form" class="bg-gray-800 p-6 rounded-lg shadow border border-gold-500">
                            <div class="mb-4">
                                <label for="current-password" class="block gold-text mb-2">Senha Atual</label>
                                <input type="password" id="current-password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-700 border-gold-500 text-white" required>
                            </div>
                            <div class="mb-4">
                                <label for="new-password" class="block gold-text mb-2">Nova Senha</label>
                                <input type="password" id="new-password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-700 border-gold-500 text-white" required>
                                <div class="password-strength strength-0 mt-1" id="password-strength"></div>
                                <small class="text-gold-500 mt-1 block">A senha deve conter pelo menos 8 caracteres, incluindo maiúsculas, minúsculas, números e caracteres especiais.</small>
                            </div>
                            <div class="mb-6">
                                <label for="confirm-password" class="block gold-text mb-2">Confirmar Nova Senha</label>
                                <input type="password" id="confirm-password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gold-500 bg-gray-700 border-gold-500 text-white" required>
                                <small class="text-red-500 mt-1 block hidden" id="password-mismatch">As senhas não coincidem.</small>
                            </div>
                            <div class="flex justify-end space-x-4">
                                <button type="button" id="cancel-change-password" class="px-4 py-2 border border-gold-500 rounded-lg text-gold-500 hover:bg-gray-700">Cancelar</button>
                                <button type="submit" class="px-4 py-2 gold-bg hover:bg-gold-600 text-dark-900 rounded-lg">Alterar Senha</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        let db = {
            users: [],
            products: []
        };
        let isAuthenticated = false;
        let currentUser = null;

        const GITHUB_JSON_URL = 'https://raw.githubusercontent.com/seu-usuario/seu-repositorio/main/data.json ';

        // Carregar dados do JSON
        async function loadDatabase() {
            try {
                const savedDb = localStorage.getItem('localDB');
                if (savedDb) {
                    db = JSON.parse(savedDb);
                } else {
                    const res = await fetch(GITHUB_JSON_URL);
                    db = await res.json();
                }
                console.log("Banco carregado com sucesso!");
            } catch (err) {
                alert("Erro ao carregar o banco de dados.");
                console.error(err);
            }
        }

        // Salvar dados no localStorage
        function saveDatabase() {
            localStorage.setItem('localDB', JSON.stringify(db));
        }

        // Renderizar produtos na loja
        function renderProducts() {
            const container = document.querySelector("#shop-page .grid");
            container.innerHTML = "";
            db.products.forEach(product => {
                const card = document.createElement("div");
                card.className = "product-card bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gold-500";
                card.innerHTML = `
                    <img src="${product.image_url}" alt="${product.name}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold gold-text">${product.name}</h3>
                        <p class="text-gray-300 mb-4">${product.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-2xl gold-text">R$ ${parseFloat(product.price).toFixed(2)}</span>
                            <a href="${product.purchase_link}" target="_blank" class="px-4 py-2 gold-bg text-dark-900 rounded-lg">Comprar</a>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Renderizar lista de produtos no painel admin
        function renderAdminProducts() {
            const tbody = document.getElementById("admin-products-list");
            tbody.innerHTML = "";
            db.products.forEach(product => {
                const tr = document.createElement("tr");
                tr.className = "table-row";
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <img src="${product.image_url}" alt="${product.name}" class="h-10 w-10 rounded-full">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">${product.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm gold-text">R$ ${parseFloat(product.price).toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300 truncate max-w-xs">${product.purchase_link}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                        <button onclick="editProduct(${product.id})" class="gold-text hover:text-gold-600 mr-3">Editar</button>
                        <button onclick="deleteProduct(${product.id})" class="text-red-400 hover:text-red-600">Excluir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Funções CRUD
        function getProductById(id) {
            return db.products.find(p => p.id === id);
        }

        function addProduct(product) {
            product.id = db.products.length ? Math.max(...db.products.map(p => p.id)) + 1 : 1;
            db.products.push(product);
            saveDatabase();
        }

        function updateProduct(product) {
            const idx = db.products.findIndex(p => p.id === product.id);
            if (idx > -1) {
                db.products[idx] = product;
                saveDatabase();
            }
        }

        function deleteProduct(id) {
            db.products = db.products.filter(p => p.id !== id);
            saveDatabase();
            renderAdminProducts();
            renderProducts();
        }

        // Funções auxiliares
        function getUserByUsername(username) {
            return db.users.find(u => u.username === username);
        }

        function updateUserPassword(userId, newPasswordHash) {
            const user = db.users.find(u => u.id === userId);
            if (user) {
                user.password_hash = newPasswordHash;
                saveDatabase();
            }
        }

        // Navegação entre páginas
        function showShopPage() {
            document.getElementById("shop-page").classList.remove("hidden");
            document.getElementById("login-page").classList.add("hidden");
            document.getElementById("admin-page").classList.add("hidden");
            renderProducts();
        }

        function showLoginPage() {
            document.getElementById("shop-page").classList.add("hidden");
            document.getElementById("login-page").classList.remove("hidden");
            document.getElementById("admin-page").classList.add("hidden");
        }

        function showAdminPage() {
            if (!isAuthenticated) {
                showLoginPage();
                return;
            }
            document.getElementById("shop-page").classList.add("hidden");
            document.getElementById("login-page").classList.add("hidden");
            document.getElementById("admin-page").classList.remove("hidden");
            showAdminProducts();
        }

        function showAdminProducts() {
            document.getElementById("admin-products-content").classList.remove("hidden");
            document.getElementById("admin-add-product-content").classList.add("hidden");
            document.getElementById("admin-change-password-content").classList.add("hidden");
            renderAdminProducts();
        }

        function showAddProductForm(product = null) {
            document.getElementById("admin-products-content").classList.add("hidden");
            document.getElementById("admin-add-product-content").classList.remove("hidden");
            document.getElementById("admin-change-password-content").classList.add("hidden");

            if (product) {
                document.getElementById("product-id").value = product.id;
                document.getElementById("product-name").value = product.name;
                document.getElementById("product-price").value = product.price;
                document.getElementById("product-description").value = product.description;
                document.getElementById("product-image").value = product.image_url;
                document.getElementById("product-link").value = product.purchase_link;
            } else {
                document.getElementById("add-product-form").reset();
                document.getElementById("product-id").value = "";
            }
        }

        function showChangePasswordForm() {
            document.getElementById("admin-products-content").classList.add("hidden");
            document.getElementById("admin-add-product-content").classList.add("hidden");
            document.getElementById("admin-change-password-content").classList.remove("hidden");
        }

        // Event listeners
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("login-link").addEventListener("click", (e) => {
                e.preventDefault();
                showLoginPage();
            });

            document.getElementById("shop-link").addEventListener("click", (e) => {
                e.preventDefault();
                showShopPage();
            });

            document.getElementById("admin-link").addEventListener("click", (e) => {
                e.preventDefault();
                showAdminPage();
            });

            document.getElementById("login-form").addEventListener("submit", (e) => {
                e.preventDefault();
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;
                const hashed = sha256(password);
                const user = getUserByUsername(username);

                if (user && user.password_hash === hashed) {
                    isAuthenticated = true;
                    currentUser = user;
                    document.getElementById("admin-link").classList.remove("hidden");
                    showAdminPage();
                    document.getElementById("login-error").classList.add("hidden");
                } else {
                    document.getElementById("login-error").classList.remove("hidden");
                }
            });

            document.getElementById("admin-products").addEventListener("click", (e) => {
                e.preventDefault();
                showAdminProducts();
            });

            document.getElementById("admin-add-product").addEventListener("click", (e) => {
                e.preventDefault();
                showAddProductForm();
            });

            document.getElementById("admin-change-password").addEventListener("click", (e) => {
                e.preventDefault();
                showChangePasswordForm();
            });

            document.getElementById("admin-logout").addEventListener("click", (e) => {
                e.preventDefault();
                logout();
            });

            document.getElementById("add-product-form").addEventListener("submit", (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById("product-id").value);
                const product = {
                    name: document.getElementById("product-name").value,
                    price: parseFloat(document.getElementById("product-price").value),
                    description: document.getElementById("product-description").value,
                    image_url: document.getElementById("product-image").value,
                    purchase_link: document.getElementById("product-link").value
                };

                if (id) {
                    product.id = id;
                    updateProduct(product);
                } else {
                    addProduct(product);
                }

                alert("Produto salvo com sucesso!");
                showAdminProducts();
            });

            document.getElementById("change-password-form").addEventListener("submit", (e) => {
                e.preventDefault();
                const current = document.getElementById("current-password").value;
                const newPass = document.getElementById("new-password").value;
                const confirm = document.getElementById("confirm-password").value;

                const hashedCurrent = sha256(current);

                if (hashedCurrent !== currentUser.password_hash) {
                    alert("Senha atual incorreta.");
                    return;
                }

                if (newPass.length < 8) {
                    alert("Senha deve ter no mínimo 8 caracteres.");
                    return;
                }

                if (newPass !== confirm) {
                    document.getElementById("password-mismatch").classList.remove("hidden");
                    return;
                }

                const hashedNew = sha256(newPass);
                updateUserPassword(currentUser.id, hashedNew);
                alert("Senha alterada com sucesso.");
                document.getElementById("change-password-form").reset();
            });

            document.getElementById("cancel-add-product").addEventListener("click", () => {
                showAdminProducts();
            });

            document.getElementById("cancel-change-password").addEventListener("click", () => {
                showAdminProducts();
            });

            document.getElementById("new-password").addEventListener("input", (e) => {
                checkPasswordStrength(e.target.value);
            });

            document.getElementById("confirm-password").addEventListener("input", (e) => {
                const pass = document.getElementById("new-password").value;
                if (pass !== e.target.value) {
                    document.getElementById("password-mismatch").classList.remove("hidden");
                } else {
                    document.getElementById("password-mismatch").classList.add("hidden");
                }
            });

            init();
        });

        // Inicialização
        async function init() {
            await loadDatabase();
            showShopPage();
        }

        function logout() {
            isAuthenticated = false;
            currentUser = null;
            document.getElementById("admin-link").classList.add("hidden");
            showShopPage();
        }

        function editProduct(id) {
            const product = getProductById(id);
            if (product) {
                showAddProductForm(product);
            }
        }

        function checkPasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            strength = Math.min(strength, 4);
            document.getElementById("password-strength").className = `password-strength strength-${strength}`;
        }
    </script>
</body>
</html>
